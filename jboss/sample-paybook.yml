- hosts: all
  gather_facts: yes
  remote_user: root
  become:yes
  #sudo: yes
  tasks:
    ###################################################################
    #Respaldo de Algunos Ejemplos
    #          - name: Create file
    #            file: path=/home/gabo/probe-ansible.txt state=touch
    #          - name: Copia Archivo
    #            copy:
    #                    src: /home/gabo/probe-ansible.txt
    #                    dest: /home/ansible.txt
    #                    remote_src: yes
    ###################################################################
    ################## Comandos Ya Ejecutados (Instalacion JBOSS)#########################
    - name: Instalacion de zip-unzip
      vars:
        packages:
          - zip
          - unzip
      yum:
        name: "{{ packages }}"
        state: latest
    - name: Descomprime Archivo
      unarchive:
        src: /root/jboss-eap-6.4.0.zip
        dest: /home/medios
        remote_src: yes
    - name: Crea Usuario JBOSS
      command: useradd -d /home/jboss -s /bin/bash -m jboss
    - name: Crea Password Usuario JBOSS
      command: echo 123456 |passwd jboss --stdin
    - name: Rename Folder
      command: mv /home/medios/jboss-eap-6.4 /home/jboss/jboss-6.4
    - name: Usuario JBOSS Owner carpeta JBOSS
      command: chown -R jboss:jboss /home/jboss/jboss-6.4
    - name: Permiso al directorio JBOSS
      command: chmod -R 775 /home/jboss/jboss-6.4
    - name: Modifica Archivo Profile
      shell: sed -i '$a JBOSS_HOME=/home/jboss/jboss-6.4' /etc/profile
    - name: Actualiza Cambios
      shell: source /etc/profile
    - name: Respalda Archivo StandAlone
      shell: mv /home/jboss/jboss-6.4/standalone/configuration/standalone.xml /home/jboss/jboss-6.4/standalone/configuration/standalone.xml.bkp
    - name: Copia Archivo StandAlone
      shell: cp /home/medios/ConfArchivos/standalone.xml /home/jboss/jboss-6.4/standalone/configuration
    - name: Copia JBOSS CONF
      shell: cp /home/medios/ConfArchivos/jboss-as.conf /home/jboss/jboss-6.4/
    - name: Copia BIN de JBOSS
      shell: cp /home/medios/ConfArchivos/jboss  /etc/init.d/
    - name: Dando permiso de ejecucion al Servicio jboss
      shell: chmod -R 777 /etc/init.d/jboss
    - name: Inicializa Servicio JBOSS
      service:
        name: jboss
        state: started
      #shell: service jboss start
    - name: Creación Usuario APP JBOSS
      shell: /home/jboss/jboss-6.4/bin/add-user.sh tsoft Tsoft*2018
    - name: Configuración Run Level
      shell: chkconfig jboss on
